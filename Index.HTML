<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Knowledge Championship 2024</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        :root { --primary: #4f46e5; --secondary: #4338ca; --accent: #22c55e; --dark: #1e293b; --bg: #f8fafc; }
        * { box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 10px;
        }

        /* Glass Container */
        .glass { 
            background: rgba(255, 255, 255, 0.98); 
            backdrop-filter: blur(10px); 
            border-radius: 24px; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 100%; max-width: 850px; padding: 30px; margin: 20px 0; 
            position: relative; overflow: hidden;
        }

        /* Sticky Timer */
        #timer-banner {
            position: sticky; top: 0; width: 100%; max-width: 850px;
            background: #ef4444; color: white; padding: 12px;
            text-align: center; font-weight: 800; border-radius: 12px;
            z-index: 100; display: none; margin-bottom: 10px; font-size: 1.2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header { text-align: center; margin-bottom: 30px; }
        h1 { color: var(--dark); margin: 0; font-size: 1.8rem; }
        
        /* Inputs */
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--dark); }
        input, select { 
            width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; 
            font-size: 1rem; transition: 0.3s; 
        }
        input:focus { border-color: var(--primary); outline: none; }

        /* Buttons */
        .btn { 
            padding: 14px 28px; border-radius: 12px; border: none; cursor: pointer; 
            font-weight: 700; transition: 0.3s; width: 100%; font-size: 1rem;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--secondary); transform: translateY(-2px); }
        .btn-ghost { background: #f1f5f9; color: var(--dark); border: 1px solid #e2e8f0; margin-top: 10px; }

        /* Quiz UI */
        .q-card { display: none; }
        .q-text { font-size: 1.3rem; font-weight: 700; color: var(--dark); margin-bottom: 25px; line-height: 1.4; }
        .options-grid { display: grid; gap: 12px; }
        .option { 
            background: #f8fafc; border: 2px solid #e2e8f0; padding: 16px; 
            border-radius: 14px; cursor: pointer; transition: 0.2s; font-weight: 500;
        }
        .option:hover { background: #eef2ff; border-color: var(--primary); }
        .option.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* Admin UI */
        .admin-trigger { position: absolute; top: 10px; right: 20px; color: #94a3b8; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        #admin-panel { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #e2e8f0; text-align: left; }
        th { background: #f1f5f9; }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .glass { padding: 20px; }
            h1 { font-size: 1.4rem; }
            .q-text { font-size: 1.1rem; }
        }
    </style>
</head>
<body>

<div id="timer-banner">⏳ TIME REMAINING: <span id="clock">60:00</span></div>

<div class="glass">
    <div class="admin-trigger" onclick="showLogin()">ADMIN ACCESS</div>
    
    <!-- Step 1: Registration -->
    <div id="reg-screen">
        <div class="header">
            <h1>Office Knowledge Championship</h1>
            <p>50 Questions | 60 Minutes</p>
        </div>
        <div class="input-group">
            <label>Full Name</label>
            <input type="text" id="userName" placeholder="Your Name">
        </div>
        <div class="input-group">
            <label>Employee ID</label>
            <input type="text" id="userId" placeholder="Emp ID">
        </div>
        <div class="input-group">
            <label>Department</label>
            <select id="userDept">
                <option value="">-- Choose Department --</option>
                <option>Sales</option><option>Marketing</option><option>Customer Delight</option>
                <option>IC</option><option>Research Saarthi</option><option>Availment Saarthi</option>
                <option>Founder’s office</option><option>Technology</option><option>CEO</option><option>COO</option>
            </select>
        </div>
        <button class="btn btn-primary" onclick="startQuiz()">START TEST</button>
    </div>

    <!-- Step 2: Quiz -->
    <div id="quiz-screen" class="q-card">
        <div id="q-progress" style="color: var(--primary); font-weight: bold; margin-bottom: 10px;">Question 1/50</div>
        <div id="q-text" class="q-text"></div>
        <div class="options-grid" id="options-container"></div>
        <div style="display: flex; gap: 10px; margin-top: 30px;">
            <button class="btn btn-ghost" onclick="prevQ()">Previous</button>
            <button class="btn btn-primary" id="nextBtn" onclick="nextQ()">Next</button>
            <button class="btn btn-primary" id="submitBtn" style="display:none; background: var(--accent);" onclick="finishQuiz()">SUBMIT TEST</button>
        </div>
    </div>

    <!-- Step 3: Admin Login -->
    <div id="login-screen" style="display:none">
        <h2>Admin Login</h2>
        <input type="text" id="admUser" placeholder="Username">
        <input type="password" id="admPass" placeholder="Password">
        <button class="btn btn-primary" style="margin-top:10px" onclick="doLogin()">Login</button>
    </div>

    <!-- Step 4: Admin Dashboard -->
    <div id="admin-panel">
        <h2>Admin Dashboard (Divya)</h2>
        <div style="overflow-x:auto">
            <table id="resultsTable">
                <thead><tr><th>Name</th><th>ID</th><th>Dept</th><th>Score</th></tr></thead>
                <tbody id="admin-rows"></tbody>
            </table>
        </div>
        <button class="btn btn-primary" style="margin-top:20px" onclick="exportCSV()">Download Master CSV</button>
        <button class="btn btn-ghost" onclick="location.reload()">Back to Quiz</button>
    </div>

    <!-- Step 5: Final Score -->
    <div id="finish-screen" style="display:none; text-align:center">
        <i class="fas fa-trophy" style="font-size: 60px; color: #fbbf24; margin-bottom: 20px;"></i>
        <h1>Congratulations!</h1>
        <h2 id="finalScoreDisplay"></h2>
        <p>Your response has been sent to the Admin Google Sheet.</p>
        <button class="btn btn-primary" onclick="showAnswers()">Review Correct Answers</button>
    </div>

    <div id="answer-review" style="display:none; margin-top: 30px; text-align: left; border-top: 2px solid #eee; padding-top: 20px;"></div>
</div>

<script>
    // --- SETTINGS ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwyVnhaJAf8MAuGkBx3ocPqIyC30vrXouZ_SuitfuVlGUVMio24ipNtw68g_22RoeAH/exec";
    const ADMIN_CREDS = { u: "Divya12", p: "divya123" };

    const questions = [
        { q: "Scenario: A Rs 3 crore collateral-free loan is sanctioned to a micro unit. Bank can seek CGTMSE cover for?", a: ["Full Rs 3 crores", "Only working capital portion", "Upto 75%", "Only Rs 1 crore"], c: 2 },
        { q: "For loan upto Rs 50 lakhs, an SC/ST Women Entrepreneur located in North Eastern Region can get maximum guarantee coverage of?", a: ["85%", "75%", "90%", "80%"], c: 2 },
        { q: "CGTMSE guarantee is available for which type of facility?", a: ["Only term loan", "Only working capital", "Both term loan & working capital", "Only overdraft"], c: 2 },
        { q: "Maximum eligible loan amount under CGTMSE?", a: ["Rs 2 crores", "Rs 5 crores", "Rs 10 crores", "Rs 20 crores"], c: 2 },
        { q: "Guarantee fee under CGTMSE is calculated based on?", a: ["Turnover", "Sanctioned Amount", "Outstanding Amount", "Project Cost"], c: 1 },
        { q: "Guarantee cover is invoked when?", a: ["30 days overdue", "60 days overdue", "NPA Classification", "1 EMI missed"], c: 2 },
        { q: "Primary Objective of CGTMSE is?", a: ["Provide subsidy", "Provide equity", "Provide collateral-free loan", "Reduce GST"], c: 2 },
        { q: "Maximum project cost for manufacturing sector under PMEGP?", a: ["Rs 20 lakhs", "Rs 50 lakhs", "Rs 1 crore", "Rs 2 crore"], c: 1 },
        { q: "A Rs 40 lakh manufacturing project in rural area (general category). Subsidy %?", a: ["15%", "20%", "25%", "35%"], c: 2 },
        { q: "Implementing Agency of PMEGP at national level is?", a: ["SIDBI", "NABARD", "RBI", "KVIC"], c: 3 },
        { q: "Minimum Educational Qualification required for projects above Rs 10 lakhs for manufacturing sector?", a: ["Graduate", "Diploma", "8th pass", "10th pass"], c: 2 },
        { q: "Maximum amount of grant for Proof of Concept under Startup India Seed Fund Scheme?", a: ["Rs 10 lakhs", "Rs 20 lakhs", "Rs 50 lakhs", "Rs 1 crore"], c: 1 },
        { q: "Maximum seed funding for commercialization under Startup India Seed Fund Scheme?", a: ["Rs 20 lakhs", "Rs 50 lakhs", "Rs 1 crore", "Rs 2 crore"], c: 1 },
        { q: "Startup must be recognised by?", a: ["SEBI", "DPIIT", "RBI", "MCA"], c: 1 },
        { q: "Maximum age of startup is?", a: ["5 years", "7 years", "10 years", "15 years"], c: 2 },
        { q: "Scenario: Project Cost is Rs 30 lakhs. What is maximum subsidy under PMFME?", a: ["Rs 9 lakhs", "Rs 10 lakhs", "Rs 12 lakhs", "Rs 15 lakhs"], c: 1 },
        { q: "PMFME stands for?", a: ["Prime Minister Formal Micro Enterprise", "Pradhan Mantri Formalisation of Micro Food Processing Enterprises", "Prime Ministry Food Manufacturing", "Public Micro Food Marketing"], c: 1 },
        { q: "Minimum beneficiary contribution under PMFME is?", a: ["5%", "10%", "15%", "20%"], c: 1 },
        { q: "Minimum ownership required of SC and ST under National SC ST Hub is?", a: ["26%", "49%", "51%", "75%"], c: 2 },
        { q: "One of the mandatory document for availing National SC - ST Hub scheme is?", a: ["Caste Certificate", "Export License", "Pollution Clearance", "SEBI Registration"], c: 0 },
        { q: "Maximum loan under Pradhan Mantri Mudra Yojana?", a: ["Rs 10 lakhs", "Rs 20 lakhs", "Rs 50 lakhs", "Rs 1 crore"], c: 0 },
        { q: "Three categories of loan under Pradhan Mantri Mudra Yojana are?", a: ["Small, Medium, Large", "Shishu, Kishor, Tarun", "Basic, Advanced, Pro", "STHAPAN, PRAYAS, VIKAS"], c: 1 },
        { q: "Electricity Duty Exemption under Package Scheme of Incentives is provided for?", a: ["1 year", "3 years", "5 years", "10 years"], c: 2 },
        { q: "Package Scheme of Incentives is for which sector?", a: ["Manufacturing Sector", "Service Sector", "Agriculture Sector", "Both"], c: 0 },
        { q: "Capital Subsidy under PSI is based on?", a: ["Total Turnover", "Fixed Capital Investment", "GST", "Export"], c: 1 },
        { q: "Validity of Textile Policy?", a: ["2020 - 2025", "2023 - 2028", "2024 - 2029", "2022 - 2027"], c: 1 },
        { q: "Reimbursement under RoDTEP is provided for?", a: ["GST Only", "Taxes not refunded elsewhere", "Customs duty", "Income Tax"], c: 1 },
        { q: "RoDTEP scheme is applicable to?", a: ["All exporters", "Service Sector", "Retailers", "Importers"], c: 0 },
        { q: "ZED stands for?", a: ["Zero Export Duty", "Zero Effect Zero Defect", "Zone Dev", "Zero Emission"], c: 1 },
        { q: "Certification levels under ZED are?", a: ["Bronze, Silver, Gold", "Basic, Adv, Pro", "5 levels", "Single"], c: 0 },
        { q: "DPIIT stands for?", a: ["Dept for Promotion of Industry and Internal Trade", "Directorate", "Division", "Trade"], c: 0 },
        { q: "MUDRA stands for?", a: ["Micro Units Development & Refinance Agency", "Urban", "Medium", "Union"], c: 0 },
        { q: "Collateral-free loan of 4Cr de-risked by?", a: ["PMEGP", "PMMY", "CGTMSE", "ZED"], c: 2 },
        { q: "Entrepreneur wants margin money on new rural 35L unit?", a: ["PMMY", "PMEGP", "CGTMSE", "RoDTEP"], c: 1 },
        { q: "Scheme provides reimbursement instead of upfront subsidy?", a: ["PMEGP", "ZED", "PMFME", "ISTP"], c: 1 },
        { q: "Minimum standard rate of Annual Guarantee Fee?", a: ["1.20%", "0.85%", "1%", "0.37%"], c: 3 },
        { q: "Credit Guarantee Cover refers to?", a: ["Direct subsidy", "Insurance against default", "Collateral", "Equity"], c: 1 },
        { q: "Working Capital primarily finances what?", a: ["Land purchase", "Machinery", "Day-to-day operational expenses", "Equity"], c: 2 },
        { q: "Udyam Registration is?", a: ["Tax registration", "MSME registration portal", "Export", "FSSAI"], c: 1 },
        { q: "Credit Linked Capital Subsidy implies?", a: ["Subsidy unrelated to loan", "Subsidy linked to sanctioned credit", "Tax", "Export"], c: 1 },
        { q: "Small enterprise maximum turnover limit?", a: ["Rs 10 crores", "Rs 25 crores", "Rs 50 crores", "Rs 125 crores"], c: 2 },
        { q: "IEC Code is required for?", a: ["Domestic", "Import/Export", "GST", "Income Tax"], c: 1 },
        { q: "Budget allocation for PMEGP scheme?", a: ["27,283 Cr", "13,554 Cr", "10,000 Cr", "588 Cr"], c: 1 },
        { q: "Group A area denotes under PSI?", a: ["Areas with some dev", "Industrially developed areas", "Naxalism", "None"], c: 1 },
        { q: "Startup India Seed Fund disbursed through?", a: ["Banks", "Incubators", "NBFCs", "States"], c: 1 },
        { q: "Participation in GeM portal helps in?", a: ["Land", "Online government procurement", "Tax", "Export"], c: 1 },
        { q: "Tax holiday Section 80-IAC claimed for?", a: ["Any 3 in 7 yrs", "Any 3 in 10 yrs", "First 3 yrs", "Any 5 yrs"], c: 1 },
        { q: "Maximum turnover limit for startup is?", a: ["Rs 25 crores", "Rs 50 crores", "Rs 100 crores", "Rs 250 crores"], c: 2 },
        { q: "Startup eligible for DPIIT if it is?", a: ["Proprietorship", "Co-op Society", "Private Limited Company", "Public"], c: 2 },
        { q: "Entity formed by splitting business?", a: ["Eligible", "After 3 yrs", "Not eligible", "Conditional"], c: 2 }
    ];

    let currentIdx = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let timer;

    function startQuiz() {
        const name = document.getElementById('userName').value;
        const dept = document.getElementById('userDept').value;
        if(!name || !dept) return alert("Please fill your Name and Department!");
        
        document.getElementById('reg-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        document.getElementById('timer-banner').style.display = 'block';
        
        renderQuestion();
        startTimer();
    }

    function startTimer() {
        let timeLeft = 3600; 
        timer = setInterval(() => {
            timeLeft--;
            let mins = Math.floor(timeLeft/60), secs = timeLeft%60;
            document.getElementById('clock').innerText = `${mins}:${secs < 10 ? '0'+secs : secs}`;
            if(timeLeft <= 0) { clearInterval(timer); finishQuiz(); }
        }, 1000);
    }

    function renderQuestion() {
        const q = questions[currentIdx];
        document.getElementById('q-progress').innerText = `Question ${currentIdx + 1}/50`;
        document.getElementById('q-text').innerText = q.q;
        const container = document.getElementById('options-container');
        container.innerHTML = q.a.map((opt, i) => `
            <div class="option ${userAnswers[currentIdx] === i ? 'selected' : ''}" onclick="pickAns(${i})">${opt}</div>
        `).join('');

        document.getElementById('nextBtn').style.display = currentIdx === questions.length-1 ? 'none' : 'block';
        document.getElementById('submitBtn').style.display = currentIdx === questions.length-1 ? 'block' : 'none';
    }

    function pickAns(i) { userAnswers[currentIdx] = i; renderQuestion(); }
    function nextQ() { if(currentIdx < questions.length-1) { currentIdx++; renderQuestion(); } }
    function prevQ() { if(currentIdx > 0) { currentIdx--; renderQuestion(); } }

    function finishQuiz() {
        clearInterval(timer);
        let score = 0;
        userAnswers.forEach((ans, i) => { if(ans === questions[i].c) score++; });

        const payload = {
            name: document.getElementById('userName').value,
            id: document.getElementById('userId').value,
            dept: document.getElementById('userDept').value,
            score: `${score}/50`
        };

        // Sync to Google Sheet
        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });

        // Save for Admin View
        let hist = JSON.parse(localStorage.getItem('office_quiz_results') || '[]');
        hist.push(payload);
        localStorage.setItem('office_quiz_results', JSON.stringify(hist));

        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('timer-banner').style.display = 'none';
        document.getElementById('finish-screen').style.display = 'block';
        document.getElementById('finalScoreDisplay').innerText = `Score: ${payload.score}`;
    }

    // --- Admin Logic ---
    function showLogin() { 
        document.getElementById('reg-screen').style.display = 'none';
        document.getElementById('login-screen').style.display = 'block';
    }
    
    function doLogin() {
        if(document.getElementById('admUser').value === ADMIN_CREDS.u && document.getElementById('admPass').value === ADMIN_CREDS.p) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            loadAdminTable();
        } else alert("Wrong Password");
    }

    function loadAdminTable() {
        const hist = JSON.parse(localStorage.getItem('office_quiz_results') || '[]');
        document.getElementById('admin-rows').innerHTML = hist.map(r => `
            <tr><td>${r.name}</td><td>${r.id}</td><td>${r.dept}</td><td>${r.score}</td></tr>
        `).join('');
    }

    function exportCSV() {
        const hist = JSON.parse(localStorage.getItem('office_quiz_results') || '[]');
        let csv = "Name,ID,Dept,Score\n" + hist.map(r => `${r.name},${r.id},${r.dept},${r.score}`).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'Quiz_Master_Report.csv';
        a.click();
    }

    function showAnswers() {
        let html = "<h3>Review Your Answers:</h3>";
        questions.forEach((q, i) => {
            const userAns = userAnswers[i] !== null ? q.a[userAnswers[i]] : "Not Answered";
            const correct = q.a[q.c];
            html += `<p><b>${i+1}. ${q.q}</b><br>
                    Your Ans: <span style="color:${userAns===correct?'green':'red'}">${userAns}</span><br>
                    Correct: <span style="color:green">${correct}</span></p>`;
        });
        document.getElementById('answer-review').innerHTML = html;
        document.getElementById('answer-review').style.display = 'block';
    }
</script>

</body>
</html>